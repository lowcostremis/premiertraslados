<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier Traslados - Panel de Operador</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

    <div id="auth-section">
        <div class="login-container">
            <h2>Iniciar Sesi√≥n</h2>
            <label for="email" style="display:none">Email</label>
            <input type="email" id="email" placeholder="Correo electr√≥nico">
            <label for="password" style="display:none">Password</label>
            <input type="password" id="password" placeholder="Contrase√±a">
            <button id="login-btn">Ingresar</button>
        </div>
    </div>

    <div id="app-content" style="display: none;">
        <header>
            <h1>Panel de Operador - Premier Traslados</h1>
            <div class="user-info">
                <span id="user-email-display"></span>
                <button id="logout-btn">Cerrar Sesi√≥n</button>
            </div>
        </header>

        <nav class="main-nav">
            <button class="tab-link active" onclick="window.openTab(event, 'Reservas')">Reservas</button>
            <button class="tab-link" onclick="window.openTab(event, 'Mapa')">Mapa</button>
            <button class="tab-link" onclick="window.openTab(event, 'Administracion')">Administraci√≥n</button>
            <button class="tab-link" onclick="window.openTab(event, 'Historico')">Hist√≥rico</button>
            <button class="tab-link" onclick="window.openTab(event, 'Pasajeros')">Pasajeros</button>
        </nav>

        <main>
            <div id="Reservas" class="tab-content">
                <div class="reservas-header">
                    <button id="btn-nueva-reserva">Nueva Reserva</button>
                    <button id="btn-toggle-select-table" style="margin-left: 10px; background-color: #6c757d;">Activar Selecci√≥n M√∫ltiple</button>
                    
                    <input type="file" id="input-pdf" accept=".pdf" style="display: none;" />
                    <button id="btn-importar-pdf" style="background-color: #fd7e14; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-left: 10px;">
                        üìÑ Importar PDF
                    </button>

                    <div style="display: inline-flex; gap: 10px; align-items: center; margin-left: 10px;">
                        <input type="file" id="input-excel" accept=".xlsx, .xls" style="display: none;" />
                        <button id="btn-importar-excel" style="background-color: #28a745; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                             üìÇ Importar Excel
                        </button>
                    </div>

                    <button id="btn-importar-gmail" style="background-color: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-left: 10px;">
                        ‚úâÔ∏è Importar Gmail
                    </button>
    
                    <div class="search-container">
                      <label for="busqueda-reservas" style="display:none">Buscar</label>
                      <input type="text" id="busqueda-reservas" placeholder="Buscar pasajero, origen, destino...">
                    </div>
                </div>  

                <nav class="sub-nav">
                    <button class="sub-tab-btn" onclick="window.showReservasTab('importadas')" data-tab="importadas" style="color: #d63384; font-weight: bold;">Importadas (Revisi√≥n)</button>
                    <button class="sub-tab-btn active" onclick="window.showReservasTab('en-curso')" data-tab="en-curso">En Curso (Pr√≥ximas 24hs)</button>
                    <button class="sub-tab-btn" onclick="window.showReservasTab('pendientes')" data-tab="pendientes">Pendientes (+24hs)</button>
                    <button class="sub-tab-btn" onclick="window.showReservasTab('asignados')" data-tab="asignados">Asignados</button>
                </nav>
                
                <div class="time-filters">
                    <button class="map-filter-btn active" onclick="window.app.filtrarPorHoras(null)">Todas</button>
                    <button class="map-filter-btn" onclick="window.app.filtrarPorHoras(4)">Pr√≥ximas 4hs</button>
                    <button class="map-filter-btn" onclick="window.app.filtrarPorHoras(8)">Pr√≥ximas 8hs</button>
                    <button class="map-filter-btn" onclick="window.app.filtrarPorHoras(12)">Pr√≥ximas 12hs</button>
                </div>

                <div id="reservas-importadas" class="reservas-container" style="display: none; border: 2px solid #d63384; border-radius: 8px;">
                    <h2 style="color: #d63384;">Reservas Importadas (Requieren Confirmaci√≥n)</h2>
    
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #fdf2f8; margin-bottom: 10px;">
                        <div id="panel-acciones-lote" style="display: none;">
                            <span style="font-weight: bold; margin-right: 10px;">Seleccionadas: <span id="contador-check-revision">0</span></span>
                           <button id="btn-confirmar-lote" class="btn-success-small">‚úÖ Confirmar Seleccionadas</button>
                           <button id="btn-borrar-lote" class="btn-danger-small">üóëÔ∏è Borrar Seleccionadas</button>
                         </div>
        
                         <button id="btn-limpiar-revision" class="btn-danger">üî• Borrar TODAS las de Revisi√≥n</button>
                     </div>
           
                     <div class="table-wrapper">
                          <table id="tabla-importadas">
                             <thead>
                                 <tr>
                                 <th style="width: 40px; text-align: center;"><input type="checkbox" id="check-all-revision"></th>
                                 <th>Autorizaci√≥n</th><th>Siniestro</th><th>Fecha</th><th>Hora Turno</th><th>Pasajero</th><th>Origen</th><th>Destino</th><th>Distancia</th><th>Hora Fin Est.</th><th>Cliente</th><th>Estado</th><th>Acciones</th>
                             </tr>
                          </thead>
                          <tbody></tbody>
                      </table>
                  </div>
                </div>

                <div id="reservas-en-curso" class="reservas-container">
                    <h2>En Curso (Pr√≥ximas 24hs)</h2>
                    <div class="table-wrapper">
                        <table id="tabla-en-curso">
                            <thead>
                                <tr>
                                    <th>Autorizaci√≥n</th><th>Siniestro</th><th>Fecha</th><th>Hora Turno</th><th>Hora Pickup</th><th>Pasajero</th><th>Origen</th><th>Destino</th><th>Cant.</th><th>Zona</th><th>Distancia</th><th>Hora Fin Est.</th><th>Cliente</th><th>Estado</th><th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="reservas-pendientes" class="reservas-container" style="display: none;">
                    <h2>Pendientes (+24hs)</h2>
                    <div class="table-wrapper">
                        <table id="tabla-pendientes">
                            <thead>
                                <tr>
                                    <th>Autorizaci√≥n</th><th>Siniestro</th><th>Fecha</th><th>Hora Turno</th><th>Hora Pickup</th><th>Pasajero</th><th>Origen</th><th>Destino</th><th>Cant.</th><th>Zona</th><th>Distancia</th><th>Hora Fin Est.</th><th>Cliente</th><th>Estado</th><th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="reservas-asignados" class="reservas-container" style="display: none;">
                    <h2>Viajes Asignados</h2>
                    <div class="filter-container" style="margin-bottom: 15px; text-align: left;">
                        <label for="filtro-chofer-asignados" style="margin-right: 10px;">Filtrar por m√≥vil:</label>
                        <select id="filtro-chofer-asignados" onchange="window.app.filtrarReservasAsignadasPorChofer(this.value)"></select>
                    </div>
                    <div class="table-wrapper">
                        <table id="tabla-asignados">
                            <thead>
                                <tr>
                                    <th>Autorizaci√≥n</th><th>Siniestro</th><th>Fecha</th><th>Hora Turno</th><th>Hora Pickup</th><th>Pasajero</th><th>Origen</th><th>Destino</th><th>Cant.</th><th>Zona</th><th>Distancia</th><th>Hora Fin Est.</th><th>Cliente</th><th>Estado</th><th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="resultados-busqueda-reservas" class="reservas-container" style="display: none;">
                    <h2>Resultados de B√∫squeda</h2>
                    <div class="table-wrapper">
                        <table id="tabla-resultados-busqueda">
                            <thead>
                                <tr>
                                    <th>Autorizaci√≥n</th><th>Siniestro</th><th>Fecha</th><th>Hora Turno</th><th>Hora Pickup</th><th>Pasajero</th><th>Origen</th><th>Destino</th><th>Cant.</th><th>Zona</th><th>Distancia</th><th>Hora Fin Est.</th><th>Cliente</th><th>Estado</th><th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="Mapa" class="tab-content" style="display: none;">
                <div class="map-controls">
                    <div class="map-filters">
                        <button class="map-filter-btn active" onclick="window.app.filtrarMapa('Todos')">Todos</button>
                        <button class="map-filter-btn" onclick="window.app.filtrarMapa('En Curso')">En Curso</button>
                        <button class="map-filter-btn" onclick="window.app.filtrarMapa('Asignado')">Asignados</button>
                        <button class="map-filter-btn" onclick="window.app.filtrarMapa('Pendiente')">Pendientes</button> 
                        <button id="btn-multi-select" class="map-filter-btn">Selecci√≥n M√∫ltiple</button>
                    </div>
                    <div class="time-filters-map">
                        <button class="map-filter-btn active" onclick="window.app.filtrarMapaPorHoras(null)">24hs</button>
                        <button class="map-filter-btn" onclick="window.app.filtrarMapaPorHoras(4)">4hs</button>
                        <button class="map-filter-btn" onclick="window.app.filtrarMapaPorHoras(8)">8hs</button>
                        <button class="map-filter-btn" onclick="window.app.filtrarMapaPorHoras(12)">12hs</button>
                    </div>
                    
                    <div class="chofer-filter">
                        <label for="filtro-chofer-mapa" style="display:none">Chofer</label>
                        <select id="filtro-chofer-mapa" onchange="window.app.filtrarMapaPorChofer(this.value)">
                            <option value="">Ver todos los m√≥viles</option>
                        </select>
                    </div>
                    <div class="toggle-switch">
                        <label for="toggle-choferes">Mostrar M√≥viles</label>
                        <input type="checkbox" id="toggle-choferes" checked>
                    </div>
                </div>
                <div id="map-container"></div>
                <div id="map-context-menu" style="display:none; position:absolute; background-color:white; border:1px solid #ccc; z-index:1000;">
                    <ul id="map-context-menu-items" style="list-style:none; margin:0; padding:5px;"></ul>
                </div>
            </div>

            <div id="Administracion" class="tab-content" style="display: none;">
                <nav class="sub-nav">
                    <button class="sub-tab-btn active" onclick="window.openAdminTab(event, 'admin-clientes')">Clientes</button>
                    <button class="sub-tab-btn" onclick="window.openAdminTab(event, 'admin-choferes')">Choferes</button>
                    <button class="sub-tab-btn" onclick="window.openAdminTab(event, 'admin-moviles')">M√≥viles</button>
                    <button class="sub-tab-btn" onclick="window.openAdminTab(event, 'admin-usuarios')">Usuarios</button>
                    <button class="sub-tab-btn" onclick="window.openAdminTab(event, 'admin-zonas')">Zonas</button>
                    <button class="sub-tab-btn" onclick="window.openAdminTab(event, 'admin-reportes')" style="color: #6f42c1; font-weight: bold;">üìä Reportes</button>
                </nav>

                <div id="admin-clientes" class="admin-tab-content">
                    <div class="admin-section">
                        <h2>Clientes</h2>
                        <form id="form-clientes" class="admin-form">
                            <label for="cliente-nombre" style="display:none">Nombre</label>
                            <input type="text" id="cliente-nombre" name="nombre" placeholder="Nombre del Cliente" required>
                            <label for="cliente-cuit" style="display:none">CUIT</label>
                            <input type="text" id="cliente-cuit" name="cuit" placeholder="CUIT">
                            <label for="cliente-domicilio" style="display:none">Domicilio</label>
                            <input type="text" id="cliente-domicilio" name="domicilio" placeholder="Domicilio">
                            <label for="cliente-telefono" style="display:none">Tel</label>
                            <input type="text" id="cliente-telefono" name="telefono" placeholder="Tel√©fono">
                            <label for="cliente-color" style="display:none">Color</label>
                            <input type="color" id="cliente-color" name="color" value="#FFFFFF">
                            <button type="submit">Guardar Cliente</button>
                        </form>
                        <div id="lista-clientes"></div>
                    </div>
                </div>

                <div id="admin-choferes" class="admin-tab-content" style="display: none;">
                    <div class="admin-section">
                        <h2>Choferes</h2>
                        <form id="form-choferes" class="admin-form">
                           <div class="form-group">
                               <label for="chofer-movil-select">M√≥vil Actual (Opcional)</label>
                               <select name="movil_actual_id" id="chofer-movil-select"></select>
                           </div>
                            <div class="form-group">
                               <label for="chofer-dni">DNI (ser√° el ID)</label>
                               <input type="text" id="chofer-dni" name="dni" placeholder="DNI del chofer" required>
                            </div>
                            <div class="form-group">
                               <label for="chofer-nombre">Nombre y Apellido</label>
                               <input type="text" id="chofer-nombre" name="nombre" placeholder="Nombre completo" required>
                           </div>
                           <div class="form-group">
                              <label for="chofer-email">Email de Acceso</label>
                              <input type="email" id="chofer-email" name="email" placeholder="correo@ejemplo.com" required>
                           </div>
                           <div class="form-group">
                              <label for="chofer-password">Contrase√±a Inicial</label>
                              <input type="password" id="chofer-password" name="password" placeholder="M√≠nimo 6 caracteres" required>
                           </div>
                             <div class="form-group">
                              <label for="chofer-domicilio">Domicilio</label>
                              <input type="text" id="chofer-domicilio" name="domicilio" placeholder="Domicilio del chofer">
                           </div>
                             <div class="form-group">
                              <label for="chofer-telefono">Tel√©fono</label>
                              <input type="text" id="chofer-telefono" name="telefono" placeholder="Tel√©fono de contacto">
                            </div>
    
                            <button type="submit">Crear Chofer</button>
                        </form>
                        <label for="busqueda-choferes" style="display:none">Buscar</label>
                        <input type="text" id="busqueda-choferes" placeholder="Buscar por nombre, DNI o N¬∞ de M√≥vil...">
                        <div id="lista-choferes"></div>
                    </div>
                </div>
                
                <div id="admin-moviles" class="admin-tab-content" style="display: none;">
                    <div class="admin-section">
                        <h2>M√≥viles</h2>
                        <form id="form-moviles" class="admin-form">
                            <label for="movil-numero" style="display:none">N</label>
                            <input type="number" id="movil-numero" name="numero" placeholder="N¬∞ de M√≥vil" required>
                            <label for="movil-patente" style="display:none">Patente</label>
                            <input type="text" id="movil-patente" name="patente" placeholder="Patente" required>
                            <label for="movil-marca" style="display:none">Marca</label>
                            <input type="text" id="movil-marca" name="marca" placeholder="Marca">
                            <label for="movil-modelo" style="display:none">Modelo</label>
                            <input type="text" id="movil-modelo" name="modelo" placeholder="Modelo">
                            <label for="movil-capacidad" style="display:none">Cap</label>
                            <input type="number" id="movil-capacidad" name="capacidad_pasajeros" placeholder="Capacidad Pasajeros" value="4">
                            <label for="movil-titular" style="display:none">Titular</label>
                            <input type="text" id="movil-titular" name="titular_nombre" placeholder="Nombre del Titular">
                            <label for="movil-titular-dom" style="display:none">Dom</label>
                            <input type="text" id="movil-titular-dom" name="titular_domicilio" placeholder="Domicilio del Titular">
                            <label for="movil-titular-tel" style="display:none">Tel</label>
                            <input type="text" id="movil-titular-tel" name="titular_telefono" placeholder="Tel√©fono del Titular">
                            <button type="submit">Guardar M√≥vil</button>
                        </form>
                        <div id="lista-moviles"></div>
                    </div>
                </div>
                   <div id="admin-reportes" class="admin-tab-content" style="display: none;">
                       <div class="admin-section">
                          <h2>Reportes del Sistema</h2>
                          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
            
                          <div class="report-card" style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; text-align: center; background: #f8f9fa;">
                            <span style="font-size: 30px;">üë®‚Äç‚úàÔ∏è</span>
                         <h3>Productividad por Chofer</h3>
                          <p>Resumen de viajes, km y horas de espera por m√≥vil.</p>
                          <button onclick="document.getElementById('modal-param-chofer').style.display='block'" style="background: #6f42c1; color: white; width: 100%;">Configurar Informe</button>
                      </div>

                         <div class="report-card" style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; text-align: center; background: #f8f9fa;">
                           <span style="font-size: 30px;">üè¢</span>
                           <h3>Traslados por Empresa</h3>
                           <p>Detalle t√©cnico de viajes realizados para un cliente espec√≠fico.</p>
                            <button onclick="document.getElementById('modal-param-empresa').style.display='block'" style="background: #007bff; color: white; width: 100%;">Configurar Informe</button>
                         </div>

                      </div>
                  </div>
                </div>

                        <div id="modal-param-chofer" class="modal">
                         <div class="modal-content" style="max-width: 400px;">
                          <h3>Configurar Informe Chofer</h3>
                            <label>Desde:</label><input type="date" id="rep-chofer-desde" class="form-control" style="width:100%; margin-bottom:10px;">
                           <label>Hasta:</label><input type="date" id="rep-chofer-hasta" class="form-control" style="width:100%; margin-bottom:10px;">
                           <label>Chofer (Opcional):</label>
                           <select id="rep-chofer-select" class="form-control" style="width:100%; margin-bottom:20px; padding: 8px;"></select>
                        <div style="display:flex; gap:10px;">
                          <button onclick="window.ejecutarReporteChofer()" style="flex:1; background:#6f42c1; color:white;">Generar</button>
                           <button onclick="document.getElementById('modal-param-chofer').style.display='none'" style="flex:1; background:#ccc;">Cancelar</button>
                     </div>
                 </div>
                </div>

                        <div id="modal-param-empresa" class="modal">
                        <div class="modal-content" style="max-width: 400px;">
                          <h3>Configurar Informe Empresa</h3>
                          <label>Empresa:</label>
                       <select id="rep-empresa-select" class="form-control" style="width:100%; margin-bottom:10px; padding: 8px;"></select>
                     <label>Desde:</label><input type="date" id="rep-empresa-desde" class="form-control" style="width:100%; margin-bottom:10px;">
                      <label>Hasta:</label><input type="date" id="rep-empresa-hasta" class="form-control" style="width:100%; margin-bottom:20px;">
                     <div style="display:flex; gap:10px;">
                        <button onclick="window.ejecutarReporteEmpresa()" style="flex:1; background:#007bff; color:white;">Generar</button>
                       <button onclick="document.getElementById('modal-param-empresa').style.display='none'" style="flex:1; background:#ccc;">Cancelar</button>
                   </div>
                </div>
                </div>
                <div id="admin-usuarios" class="admin-tab-content" style="display: none;">
                    <div class="admin-section">
                        <h2>Usuarios del Sistema</h2>
                        <form id="form-usuarios" class="admin-form">
                            <label for="usuario-nombre" style="display:none">Nombre</label>
                            <input type="text" id="usuario-nombre" name="nombre" placeholder="Nombre de Operador" required>
                            <label for="usuario-email" style="display:none">Email</label>
                            <input type="email" id="usuario-email" name="email" placeholder="Email de Acceso" required>
                            <label for="usuario-pass" style="display:none">Pass</label>
                            <input type="password" id="usuario-pass" name="password" placeholder="Contrase√±a" required>
                            <button type="submit">Crear Usuario</button>
                        </form>
                        <div id="lista-usuarios"></div>
                    </div>
                </div>

                <div id="admin-zonas" class="admin-tab-content" style="display: none;">
                    <div class="admin-section">
                        <h2>Zonas</h2>
                        <form id="form-zonas" class="admin-form">
                            <label for="zona-numero" style="display:none">N</label>
                            <input type="number" id="zona-numero" name="numero" placeholder="N√∫mero de Zona" required>
                            <label for="zona-descripcion" style="display:none">Desc</label>
                            <input type="text" id="zona-descripcion" name="descripcion" placeholder="Descripci√≥n (Ej: Zona Norte)" required>
                            <button type="submit">Guardar Zona</button>
                        </form>
                        <div id="lista-zonas"></div>
                    </div>
                </div>
            </div>

            <div id="Historico" class="tab-content" style="display: none;">
                <h2>Historial de Viajes</h2>
                <div class="toolbar" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                      <input type="date" id="fecha-desde-historial">
                      <input type="date" id="fecha-hasta-historial">
                      <select id="filtro-cliente-historial" style="min-width: 200px;">
                         <option value="">Todos los clientes</option>
                      </select>
                      <button id="btn-exportar-excel-hist">Exportar a Excel</button>
                      <input type="text" id="search-historial-input" placeholder="Buscar en historial..." style="flex-grow: 1;">
                 </div>
                
                
                 <div id="paginacion-historico" class="paginacion">
                     <button id="btn-anterior">Anterior</button>
                     <span id="indicador-pagina"></span>
                     <button id="btn-siguiente">Siguiente</button>
                </div>
            </div>

            <div id="Pasajeros" class="tab-content" style="display: none;">
                <h2>Gesti√≥n de Pasajeros</h2>
                 <div class="admin-section">
                    <form id="form-pasajeros" class="admin-form">
                        <label for="pasajero-dni" style="display:none">DNI</label>
                        <input type="text" id="pasajero-dni" name="dni" placeholder="DNI del Pasajero" required>
                        <label for="pasajero-nombre" style="display:none">Nombre</label>
                        <input type="text" id="pasajero-nombre" name="nombre_apellido" placeholder="Nombre y Apellido" required>
                        <label for="pasajero-telefono" style="display:none">Tel</label>
                        <input type="text" id="pasajero-telefono" name="telefono" placeholder="Tel√©fono">
                        <label for="pasajero-domicilio" style="display:none">Dom</label>
                        <input type="text" id="pasajero-domicilio" name="domicilio" placeholder="Agregar un domicilio">
                        <button type="submit">Guardar Pasajero</button>
                    </form>
                </div>
                <label for="busqueda-pasajeros-2" style="display:none">Buscar</label>
                <input type="text" id="busqueda-pasajeros-2" placeholder="Buscar pasajero por nombre o DNI...">
                <div id="lista-pasajeros"></div>
                <div id="paginacion-pasajeros" class="paginacion">
                    <button id="pasajeros-btn-anterior">Anterior</button>
                    <span id="pasajeros-indicador-pagina"></span>
                    <button id="pasajeros-btn-siguiente">Siguiente</button>
                </div>
            </div>
        </main>
    </div>

    <div id="reserva-modal" class="modal">
        <div class="modal-content" style="width: 95%; max-width: 1250px;">
            <span class="close-btn">&times;</span>
            <h2 id="modal-title">Nueva Reserva</h2>
            <div class="form-map-container">
                <form id="reserva-form">                
                       <input type="hidden" id="reserva-id" name="reserva-id">
                       <input type="hidden" id="reserva-estado-principal" name="reserva-estado-principal">
                    
                        <div class="form-row">
                            <div class="form-group">
                              <label for="cliente">Cliente</label>
                              <select id="cliente" name="cliente"></select>
                         </div>
                     </div>

                     <div class="form-row">
                         <div class="form-group">
                            <label for="siniestro">Siniestro</label>
                            <input type="text" id="siniestro" name="siniestro">
                        </div>
                        <div class="form-group">
                            <label for="autorizacion">Autorizaci√≥n</label>
                            <input type="text" id="autorizacion" name="autorizacion">
                        </div>
                    </div>
                    <h3>Datos del Pasajero</h3>
                    <div class="form-row">
                         <div class="form-group">
                            <label for="dni_pasajero">DNI Pasajero</label>
                            <input type="text" id="dni_pasajero" name="dni_pasajero">
                        </div>
                         <div class="form-group">
                            <label for="nombre_pasajero">Nombre Pasajero</label>
                            <input type="text" id="nombre_pasajero" name="nombre_pasajero" required>
                        </div>
                        <div class="form-group">
                            <label for="telefono_pasajero">Tel√©fono Pasajero</label>
                            <input type="text" id="telefono_pasajero" name="telefono_pasajero">
                        </div>
                    </div>
                    <h3>Detalles del Viaje</h3>
                     <div class="form-row">
                         <div class="form-group">
                            <label for="fecha_turno">Fecha Turno</label>
                            <input type="date" id="fecha_turno" name="fecha_turno" required>
                        </div>
                        <div class="form-group">
                            <label for="hora_turno">Hora Turno</label>
                            <input type="time" id="hora_turno" name="hora_turno">
                        </div>
                        <div class="form-group">
                            <label for="hora_pickup">Hora Pickup</label>
                            <input type="time" id="hora_pickup" name="hora_pickup">
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group" style="align-items: flex-start;">
                              <label>Origen(es) <small>(M√°x 4)</small></label>
    
                            <div id="origenes-container" style="width: 100%; display: flex; flex-direction: column; gap: 8px;">
                                <div class="input-group-origen" style="display: flex; gap: 5px;">
                                     <input type="text" name="origen_dinamico" class="origen-input" placeholder="Origen Principal" required style="flex: 1;">
                                     <div style="width: 30px;"></div>
                                  </div>
                             </div>

                             <button type="button" id="btn-add-origen" style="margin-top: 8px; background: transparent; border: 1px dashed #6c757d; padding: 5px; width: 100%; cursor: pointer;">
                                     + Agregar parada de origen
                             </button>
                         </div>
                   </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="destino">Destino</label>
                            <input type="text" id="destino" name="destino">
                        </div>
                    </div>
                   
                    <div class="form-row" style="background: #e9ecef; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                         <div class="form-group">
                             <label for="distancia_total_input" style="color: #1877f2; font-weight: bold;">Distancia Total (Km)</label>
                             <input type="text" id="distancia_total_input" name="distancia_total" readonly style="font-weight: bold; color: #333;" placeholder="0.0 km">
                         </div>
                         <div class="form-group">
                              <label>Tiempo Estimado</label>
                              <input type="text" id="tiempo_total_input" readonly placeholder="0 min">
                              <input type="hidden" id="duracion_estimada_minutos" name="duracion_estimada_minutos">
                         </div>
                    </div>

                    <div class="form-row">
                          <div class="form-group">
                                <label for="espera_total">Horas de Espera Totales</label>
                                <input type="number" id="espera_total" name="espera_total" step="0.5" min="0" placeholder="Ej: 1.5">
                         </div>
                         <div class="form-group">
                                <label for="espera_sin_cargo">Horas Espera 'Sin Cargo'</label>
                                <input type="number" id="espera_sin_cargo" name="espera_sin_cargo" step="0.5" min="0" placeholder="Ej: 0.5">
                         </div>
                    </div>          

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cantidad_pasajeros">Cantidad Pasajeros</label>
                            <input type="number" id="cantidad_pasajeros" name="cantidad_pasajeros" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="zona">Zona</label>
                            <select id="zona" name="zona"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="observaciones">Observaciones</label>
                        <textarea id="observaciones" name="observaciones"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="asignar_movil">Asignar M√≥vil (Opcional)</label>
                        <select id="asignar_movil" name="asignar_movil">
                            <option value="">No asignar m√≥vil a√∫n</option>
                        </select>
                    </div>
                    
                    <div class="form-row" style="justify-content: flex-start; align-items: center; gap: 30px; margin-top: 15px;">
                        <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px; margin-bottom: 0;">
                            <input type="checkbox" id="tiene_regreso" name="tiene_regreso" style="width: auto;">
                            <label for="tiene_regreso" style="margin: 0;">¬øGenerar viaje de regreso?</label>
                        </div>
                        <div class="form-group" style="flex-direction: row; align-items: center; gap: 10px; margin-bottom: 0;">
                            <input type="checkbox" id="viaje_exclusivo" name="viaje_exclusivo" style="width: auto;">
                            <label for="viaje_exclusivo" style="margin: 0;">Viaje Exclusivo</label>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" style="flex: 1;">Guardar Reserva</button>
                        <button type="button" id="btn-confirmar-modal" style="flex: 1; background-color: #28a745; color: white; font-weight: bold; display: none;">‚úÖ Confirmar e Importar</button>
                    </div>

                </form>
                <div id="mapa-modal-container" style="flex: 1.2; height: 600px; background: #eee;"></div>
            </div>
        </div>
    </div>

    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-edit-btn">&times;</span>
            <h2 id="edit-modal-title">Editar Item</h2>
            <form id="edit-form"></form>
        </div>
    </div>
    
    <div id="reset-password-modal" class="modal">
        <div class="modal-content">
            <span class="close-reset-password-btn">&times;</span>
            <h2>Resetear Contrase√±a de <span id="reset-chofer-nombre"></span></h2>
            <form id="reset-password-form">
                <input type="hidden" id="reset-chofer-uid">
                <label for="nueva-password" style="display:none">Pass</label>
                <input type="password" id="nueva-password" placeholder="Nueva Contrase√±a" required>
                <button type="submit">Actualizar Contrase√±a</button>
            </form>
        </div>
    </div>

    <div id="multi-select-panel" style="display: none; position: fixed; bottom: 20px; right: 20px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 2000;">
        <h3>Selecci√≥n (<span id="contador-seleccion">0</span>)</h3>
        </div>

        <div id="reporte-modal" class="modal" style="display: none; z-index: 3000;">
             <div class="modal-content" style="width: 95%; max-width: 1100px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #6f42c1; padding-bottom: 10px; margin-bottom: 20px;">
                        <h2 id="titulo-reporte-dinamico" style="margin: 0; color: #6f42c1;">Reporte del Sistema</h2>
                       <div>
                          <button id="btn-excel-reporte" style="background: #28a745; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">üìä Exportar Excel</button>
                          <button onclick="window.printReport()" style="background: #dc3545; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">üìÑ Imprimir PDF</button>
                          <button onclick="document.getElementById('reporte-modal').style.display='none'" style="background: #6c757d; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cerrar</button>
                      </div>
                 </div>
                <div id="reporte-body-print"></div>
         </div>
        </div>
                
              

             
                

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.23.3/dist/algoliasearch-lite.umd.js"></script>
    
    <script>
    (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.googleapis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
      key: "AIzaSyD33ys3G9-hHG0aw34EQByXecK3c7oEbFo", 
      v: "weekly"
    });
    </script>
    
    <script type="module" src="js/main.js"></script> 
    <script type="module" src="js/informes.js"></script>
    
    <script type="module">
        import { conectarSeleccionMultiple } from './js/reservas.js';
        document.addEventListener('DOMContentLoaded', () => {
            conectarSeleccionMultiple();
        });
    </script>
</body>
</html>